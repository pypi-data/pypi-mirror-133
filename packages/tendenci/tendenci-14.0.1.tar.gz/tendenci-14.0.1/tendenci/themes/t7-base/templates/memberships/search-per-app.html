{% extends "memberships/base-wide.html" %}
{% load base_filters %}
{% load bootstrap_pagination_tags %}
{% load perm_tags %}
{% load profile_tags %}
{% load search_tags %}
{% load membership_tags %}


{% block title %}{% trans "Members Search" %}{% endblock %}

{% block extra_head %}
    {{ block.super }}
    <link rel="stylesheet" href="{% static 'css/iconrow.css' %}" type="text/css">
    <link rel="stylesheet" href="{% static 'css/profiles.css' %}" type="text/css">
    <link rel="stylesheet" href="{% static 'css/search.css' %}" type="text/css">

<style>
div.ex1 {
	max-height: 100vh;
	overflow-y: auto;
	/*position: sticky;*/
	top: 0;
}
#members-search-form .control-label {
	text-align: left!important;
	width: 100%;
	font-size: 1.1em;
}
h3{
	border-bottom: 1px solid #ccc; padding: 10px 0;
}
#members-wrap{
	overflow-x: auto;
}
.clearall, #export-btn{
	margin-left: 8px;
	white-space: nowrap;
}

</style>
{% endblock %}

{% block content %}
    <div class="t">
        <h1>{% trans "Members Search" %}</h1>

		<div class="row">
			<div class="col-sm-3 ex1">
				{% include "memberships/search-per-app-form.html" %}
			</div>
			<div class="col-sm-9">
				<h3>{% trans "Members Applied" %} <a href="{{ app.get_absolute_url }}">{{ app.name }}</a>
				</h3>
				
				{% autopaginate memberships 20 %}

		        {% if memberships %}
		            <span><em>{{ paginator.count }} Member{{ paginator.count|pluralize }} {% trans "Found" %}</em></span>
		        {% else %}
		            <p>{% trans "Sorry, we didn't find anything for your search."%}</p>
		        {% endif %}


				{% if paginator.count > 0  %}
				<div id="members-wrap">
				<table class="table table-striped table-bordered">
					<tr>
					<th>View</th>
					<th>Edit</th>
					{% for app_field in app_fields %}
						<th nowrap>{{ app_field.label }}</th>
					{% endfor %}
					<th nowrap>{% trans "Create Date" %}</th>
					<th nowrap>{% trans "Join Date" %}</th>
					<th nowrap>{% trans "Renew Date" %}</th>
					<th nowrap>{% trans "Expire Date" %}</th>
					<th nowrap>{% trans "Status Detail" %}</th>
					</tr>
			
					{% for membership in memberships %}
					<tr>
						<td><a href="{% url "membership.details" membership.id  %}"><img src="{% static 'images/icons/external_16x16.png' %}" alt="View membership: {{ membership }}"></a></td>
						<td><a href="{% url "membership_default.edit" membership.id  %}">{% trans "Edit" %}</a></td>
						{% render_member_row membership app_fields %}
						<td nowrap>{{ membership.create_dt|date:"N j, Y" }}</td>
						<td nowrap>{{ membership.join_dt|date:"N j, Y" }}</td>
						<td nowrap>{% if membership.renew_dt %}{{ membership.renew_dt|date:"N j, Y" }}{% endif %}</td>
						<td nowrap>{% if membership.expire_dt %}{{ membership.expire_dt|date:"N j, Y" }}{% endif %}</td>
						<td nowrap>{{ membership.status_detail }}</td>
					</tr>
					{% endfor %}
				</table>
				</div>
				<i>{% trans "** Scroll left to view more columns" %}</i>
				{% endif %}

		
		        {% paginate %}
						
			</div>
		</div>

    </div>
{% endblock %}

{% block extra_body %}
{{ block.super }}
<script type="text/javascript">
	$(".clearall").on("click", function(event) {
		event.preventDefault();
	    $("#members-search-form")[0].reset();
		$("#members-search-form input[type='text']").val('');
		$("#members-search-form input[type='checkbox']:checked").prop('checked', false);
		$("#members-search-form select option:selected").prop('selected', false);
	});
</script>
{% endblock %}
